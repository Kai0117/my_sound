<body class="bg-gradient-to-br from-slate-800 to-slate-900 text-white min-h-screen flex flex-col items-center justify-center px-4">
<main class="flex flex-col items-center justify-center min-h-screen w-full space-y-8">

    <h1 class="text-4xl font-bold mb-6 float-title">Mind Sound</h1>

 
    <div class="flex items-center space-x-3">
      <span class="text-sm text-gray-300">ãƒ†ã‚­ã‚¹ãƒˆãƒ¢ãƒ¼ãƒ‰</span>
      <label class="relative inline-flex items-center cursor-pointer">
        <input type="checkbox" id="mode-toggle" class="sr-only peer">
        <div class="w-11 h-6 bg-gray-600 rounded-full peer peer-checked:after:translate-x-full peer-checked:bg-blue-500
                    after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white
                    after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all">
        </div>
      </label>
      <span class="text-sm text-gray-300">ç›´æ„Ÿãƒ¢ãƒ¼ãƒ‰</span>
    </div>

    <!-- âœï¸ ãƒ†ã‚­ã‚¹ãƒˆæ¤œç´¢ãƒ•ã‚©ãƒ¼ãƒ  -->
    <div id="text-search" class="flex flex-col items-center space-y-4 w-full max-w-md">
      <form action="<%= sound_infos_path %>" method="post" class="w-full">
        <%= hidden_field_tag :authenticity_token, form_authenticity_token %>
        <textarea
          name="emotion_text"
          placeholder="ä¾‹: ã¡ã‚‡ã£ã¨ç–²ã‚ŒãŸâ€¦ãƒ†ãƒ³ã‚·ãƒ§ãƒ³è½ã¨ã—ãŸã„â€¦"
          rows="4"
          class="w-full p-4 rounded-2xl text-white bg-transparent border border-blue-500/50 shadow-md focus:ring-2 focus:ring-blue-400 focus:outline-none resize-none transition placeholder-blue-300 text-lg"
        ></textarea>
        <button
          type="submit"
          class="mt-4 w-full bg-blue-500 hover:bg-blue-400 text-white font-semibold py-3 px-6 rounded-full shadow-md transition transform hover:scale-105 hover:shadow-blue-300/40">
          Search
        </button>
      </form>
    </div>

   
    <div id="loading-text" class="hidden text-center mt-6">
      <p class="text-lg font-semibold text-blue-100">æ¤œç´¢ä¸­ã§ã™â€¦ğŸ§</p>
      <div class="animate-spin rounded-full h-10 w-10 border-t-4 border-blue-500 mx-auto mt-4"></div>
    </div>

  
    <div id="intuitive-search" class="hidden flex flex-col items-center space-y-6">

      <div class="relative w-80 h-80" id="mood-map">
        <!-- ç¸¦æ¨ªç·š -->
        <div class="absolute inset-0 flex">
          <div class="w-1/2 border-r border-white/30"></div>
          <div class="w-1/2"></div>
        </div>
        <div class="absolute inset-0 flex flex-col">
          <div class="h-1/2 border-b border-white/30"></div>
          <div class="h-1/2"></div>
        </div>

        <!-- ãƒ©ãƒ™ãƒ« -->
        <div class="absolute top-2 left-3 text-sm text-white/60">Calm</div>
        <div class="absolute top-2 right-3 text-sm text-white/60">Happy</div>
        <div class="absolute bottom-2 left-3 text-sm text-white/60">Sad</div>
        <div class="absolute bottom-2 right-3 text-sm text-white/60">Energetic</div>

        <!-- ãƒã‚¤ãƒ³ã‚¿ -->
        <div id="mood-pointer"
             class="pointer-events-none absolute w-4 h-4 bg-white rounded-full transform -translate-x-1/2 -translate-y-1/2 shadow-sm"></div>
      </div>

      <!-- âœ¨ ã‚¸ãƒ£ãƒ³ãƒ«é¸æŠã‚«ãƒ¼ãƒ‰ -->
      <div class="grid grid-cols-2 sm:grid-cols-3 gap-4 mt-4 w-full max-w-md">
        <% ["Pop", "Rock", "Jazz", "Hip-hop", "Classical", "Electronic"].each do |genre| %>
          <div
            class="genre-card bg-transparent border border-white/20 rounded-xl p-3 w-32 text-center cursor-pointer transition hover:bg-white/20 hover:scale-105"
            data-genre="<%= genre.downcase %>">
            <span class="text-white font-medium"><%= genre %></span>
          </div>
        <% end %>
      </div>

      <!-- hidden inputs -->
      <form id="mood-form" action="<%= sound_infos_path %>" method="post" class="mt-3 w-full max-w-md">
        <%= hidden_field_tag :authenticity_token, form_authenticity_token %>
        <input type="hidden" name="selected_mood" id="selected-mood">
        <input type="hidden" name="selected_genres[]" id="selected-genres">
        <button
          type="submit"
          class="bg-blue-500 hover:bg-blue-400 text-white font-semibold py-2 px-6 rounded-full shadow-md transition w-full">
          Search
        </button>
      </form>
    </div>

    
    <div id="loading-mood" class="hidden mt-10 text-center">
      <div class="w-10 h-10 border-4 border-t-transparent border-blue-400 rounded-full animate-spin mx-auto"></div>
      <p class="mt-4 text-blue-100">éŸ³æ¥½ã‚’æ¢ã—ã¦ã„ã¾ã™ã€‚å°‘ã—å¾…ã£ã¦ã­â€¦</p>
    </div>

  </main>
</body>



<style>
@keyframes float {
  0%, 100% { transform: translateY(0) rotate(0deg); }
  25% { transform: translateY(-4px) rotate(-1deg); }
  50% { transform: translateY(2px) rotate(1deg); }
  75% { transform: translateY(-3px) rotate(0.5deg); }
}

.float-title {
  display: inline-block;
  animation: float 3s ease-in-out infinite;
  text-shadow: 0 0 8px rgba(59,130,246,0.4);
}
</style>


<script>
document.addEventListener("DOMContentLoaded", () => { 
  // DOMè¦ç´ å–å¾—
  const toggle = document.getElementById("mode-toggle");
  const textSearch = document.getElementById("text-search");
  const intuitiveSearch = document.getElementById("intuitive-search");
  const map = document.getElementById("mood-map");
  const pointer = document.getElementById("mood-pointer");
  const moodInput = document.getElementById("selected-mood");
  const genresInput = document.getElementById("selected-genres");
  const genreCards = document.querySelectorAll(".genre-card");
  const selectedGenres = new Set();
  const textForm = textSearch?.querySelector("form");
  const moodForm = document.getElementById("mood-form");
  const loadingText = document.getElementById("loading-text");
  const loadingMood = document.getElementById("loading-mood");

 ãˆ
  if (!toggle || !textSearch || !intuitiveSearch || !map || !pointer || !moodInput || !genresInput || !textForm || !moodForm) {
    console.warn("Some elements are missing in the DOM!");
    return;
  }

  // åˆæœŸãƒã‚¤ãƒ³ã‚¿ä½ç½®
  const cx = map.clientWidth / 2;
  const cy = map.clientHeight / 2;
  updatePointer(cx, cy);

  // ãƒ¢ãƒ¼ãƒ‰åˆ‡æ›¿
  toggle.addEventListener("change", () => {
    textSearch.classList.toggle("hidden", toggle.checked);
    intuitiveSearch.classList.toggle("hidden", !toggle.checked);
  });

  // 4è±¡é™ãƒãƒƒãƒ—ã®ãƒ ãƒ¼ãƒ‰åˆ¤å®š
  function getMood(xRatio, yRatio) {
    if (xRatio < 0.5 && yRatio < 0.5) return "calm";
    if (xRatio >= 0.5 && yRatio < 0.5) return "happy";
    if (xRatio < 0.5 && yRatio >= 0.5) return "sad";
    return "energetic";
  }

  // ãƒã‚¤ãƒ³ã‚¿ç§»å‹•æ›´æ–°
  function updatePointer(x, y) {
    pointer.style.left = `${x}px`;
    pointer.style.top = `${y}px`;
    const xRatio = x / map.clientWidth;
    const yRatio = y / map.clientHeight;
    const mood = getMood(xRatio, yRatio);
    moodInput.value = mood;

    pointer.style.background = mood === "calm" ? "#cfe8ff" :
                               mood === "happy" ? "#dfffe0" :
                               mood === "sad" ? "#e9ddff" : "#fff4c2";
  }

  // ãƒã‚¦ã‚¹ãƒ»ã‚¿ãƒƒãƒæ“ä½œ
  let isDragging = false;
  function handleMove(e) {
    e.preventDefault();
    const rect = map.getBoundingClientRect();
    const clientX = e.touches ? e.touches[0].clientX : e.clientX;
    const clientY = e.touches ? e.touches[0].clientY : e.clientY;
    const x = Math.min(Math.max(0, clientX - rect.left), rect.width);
    const y = Math.min(Math.max(0, clientY - rect.top), rect.height);
    updatePointer(x, y);
  }
  map.addEventListener("mousedown", e => { isDragging = true; handleMove(e); });
  window.addEventListener("mouseup", () => { isDragging = false; });
  map.addEventListener("mousemove", e => { if (isDragging) handleMove(e); });
  map.addEventListener("click", handleMove);

  map.addEventListener("touchstart", e => { isDragging = true; handleMove(e); }, { passive: false });
  map.addEventListener("touchmove", e => { if (isDragging) handleMove(e); }, { passive: false });
  window.addEventListener("touchend", () => { isDragging = false; });

  // ã‚¸ãƒ£ãƒ³ãƒ«é¸æŠ
  genreCards.forEach(card => {
    card.addEventListener("click", () => {
      const genre = card.dataset.genre;
      if (selectedGenres.has(genre)) {
        selectedGenres.delete(genre);
        card.classList.remove("ring-2", "ring-blue-400", "bg-white/20", "scale-105");
      } else {
        selectedGenres.add(genre);
        card.classList.add("ring-2", "ring-blue-400", "bg-white/20", "scale-105");
      }
      genresInput.value = Array.from(selectedGenres);
    });
  });


  function showLoading(formType) {
    if (formType === "text") {
      textSearch.classList.add("hidden");
      loadingText.classList.remove("hidden");
    } else if (formType === "mood") {
      intuitiveSearch.classList.add("hidden");
      loadingMood.classList.remove("hidden");
    }
  }

  textForm.addEventListener("submit", (e) => {
    e.preventDefault();
    showLoading("text");
    setTimeout(() => textForm.submit(), 1000);
  });

  moodForm.addEventListener("submit", (e) => {
    e.preventDefault();
    showLoading("mood");
    setTimeout(() => moodForm.submit(), 1000);
  });
});
</script>






